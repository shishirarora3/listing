import * as React from "react";
import styled from "styled-components";
import { warning } from "@kiwicom/js";
import convertHexToRgba from "@kiwicom/orbit-design-tokens/lib/convertHexToRgba";
import defaultTheme from "../defaultTheme";
import { baseURL, CODES } from "./consts";
const StyledCountryFlag = styled.div.withConfig({
  displayName: "CountryFlag__StyledCountryFlag",
  componentId: "h98fwe-0"
})(["position:relative;height:13px;width:", ";background-color:", ";border-radius:", ";overflow:hidden;"], ({
  theme
}) => theme.orbit.widthCountryFlag, ({
  theme
}) => theme.orbit.backgroundCountryFlag, ({
  theme
}) => theme.orbit.borderRadiusSmall);
StyledCountryFlag.defaultProps = {
  theme: defaultTheme
};
const StyledImage = styled.img.withConfig({
  displayName: "CountryFlag__StyledImage",
  componentId: "h98fwe-1"
})(["display:block;height:100%;width:100%;"]);
StyledImage.defaultProps = {
  theme: defaultTheme
};
const StyledShadow = styled.div.withConfig({
  displayName: "CountryFlag__StyledShadow",
  componentId: "h98fwe-2"
})(["position:absolute;display:block;height:100%;width:100%;top:0;right:0;bottom:0;left:0;box-shadow:inset 0 0 0 1px ", ";border-radius:", ";"], ({
  theme
}) => convertHexToRgba(theme.orbit.paletteInkNormal, 10), ({
  theme
}) => theme.orbit.borderRadiusSmall);
StyledShadow.defaultProps = {
  theme: defaultTheme
};
export function getCountryProps(code, name) {
  const codeNormalized = code ? code.toUpperCase().replace("-", "_") : "ANYWHERE";
  const countryCodeExists = codeNormalized in CODES;
  warning(countryCodeExists, "Country code not supported: %s", code);
  const countryCode = countryCodeExists ? CODES[codeNormalized] : CODES.ANYWHERE;
  const countryName = countryCode === CODES.ANYWHERE && !name ? "Anywhere" : name;
  return {
    code: countryCode,
    name: countryName
  };
}

const CountryFlag = props => {
  const {
    dataTest
  } = props;
  const {
    code,
    name
  } = getCountryProps(props.code, props.name);
  return React.createElement(StyledCountryFlag, null, React.createElement(StyledImage, {
    key: code,
    src: `${baseURL}/flags/24x0/flag-${code.toLowerCase()}.jpg`,
    srcSet: `${baseURL}/flags/48x0/flag-${code.toLowerCase()}.jpg 2x`,
    alt: name,
    title: name,
    "data-test": dataTest
  }), React.createElement(StyledShadow, null));
};

export default CountryFlag;